<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Create Application Backups :: Applications backups &amp; restores in OpenShift</title>
    <link rel="canonical" href="https://aliciamaroto.github.io/oadp-webinar-2023/applications-backups-restores/03-backups.html">
    <link rel="prev" href="02-deploy.html">
    <link rel="next" href="04-restores.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://aliciamaroto.github.io/oadp-webinar-2023">Applications backups &amp; restores in OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="applications-backups-restores" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Lab Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#clustersetup">Cluster Setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-deploy.html">2. Install and configure OADP Operator</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-deploy.html#install">Install Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-deploy.html#configure">Configure Operator</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-backups.html">3. Create Application Backups</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#app1">Application 1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#app2">Application 2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#app3">Application 3</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#app4">Application 4</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-restores.html">4. Restore Applications</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-restores.html#simple">Restore simple application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-restores.html#snapshot">Restore application with persistent storage using Snaphsots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-restores.html#restic">Restore application with persistent storage using Restic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-restores.html#datamover">Restore application with persistent storage using Data Mover</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Applications backups & restores in OpenShift</a></li>
    <li><a href="03-backups.html">3. Create Application Backups</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/aliciamaroto/oadp-webinar-2023/edit/master/documentation/modules/ROOT/pages/03-backups.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Create Application Backups</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this section we are going to test different scenarios when performing backups. We will be creating four different applications with different features and then we will back them up.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/backup.png" alt="backup">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="app1"><a class="anchor" href="#app1"></a>Application 1</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first application will be a simple application based on Apache. We can create the application as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a project called <code>application-01</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>oc new-project application-01</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Go to the Developer perspective in the OpenShift Console.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app01-1.png" alt="app01 1">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>In the developer catalogue choose the application <strong>Apache HTTP Server (httpd)</strong>  - <em>Builder image</em>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app01-2.png" alt="app01 2">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Fill the <strong>Git Repo URL</strong> by selecting <strong>Try sample</strong> and the <strong>Name</strong> with the desired application name and then click on <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app01-3.png" alt="app01 3">
</div>
</div>
<div class="paragraph">
<p>Once the application is up and running, we can perform our first backup. In order to create the backup, in the Administrator view, go to the OADP Operator and then to the Backup section. The <code>yaml</code> view of the resource will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: velero.io/v1
kind: Backup
metadata:
  name: backup-app01
  namespace: openshift-adp
spec:
  includedNamespaces:
    - application-01</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to check that the backup has been performed successfully, it has to be masked as <strong>Completed</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app01-4.png" alt="app01 4">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="app2"><a class="anchor" href="#app2"></a>Application 2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The second application will be an app based on Apache with a PVC attached, and we will be using <strong>Snapshots</strong> to perform the volume backups.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a project called <code>application-02</code></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>oc new-project application-02</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Go to the Developer perspective in the OpenShift Console and follow the same procedure as in application 01.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app02-1.png" alt="app02 1">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Once the application is up and running, we need to attach a PVC to it.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app02-2.png" alt="app02 2">
</div>
</div>
<div class="paragraph">
<p>And create a new Persistent Volume Claim for this application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app02-3.png" alt="app02 3">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Create the backup.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Then, we can proceed to create the backup. In this case, we have to make sure to set the <code>snapshotVolumes</code> parameter to <code>true</code>. The <code>yaml</code> view of the resource will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: velero.io/v1
kind: Backup
metadata:
  name: backup-app02
  namespace: openshift-adp
spec:
  includedNamespaces:
    - application-02
  snapshotVolumes: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to check that the backup has been performed successfully, it has to be masked as <strong>Completed</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app02-4.png" alt="app02 4">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="app3"><a class="anchor" href="#app3"></a>Application 3</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The third demo will be an app based on Apache with a PVC attached, and we will be using <code>Restic</code> to perform the volume backups.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a project called <code>application-03</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>oc new-project application-03</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Go to the Developer perspective in the OpenShift Console and follow the same procedure as in application 01 and 02.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app03-1.png" alt="app03 1">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Once the application is up and running, we need to attach a PVC to it.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app03-2.png" alt="app03 2">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Create the backup.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In this case, we need to set the parameter <code>defaultVolumesToFsBackup</code> to <code>true</code>. The <code>yaml</code> view of the resource will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: velero.io/v1
kind: Backup
metadata:
  name: backup-app03
  namespace: openshift-adp
spec:
  includedNamespaces:
    - application-03
  defaultVolumesToFsBackup: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to check that the backup has been performed successfully, it has to be masked as <strong>Completed</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app03-3.png" alt="app03 3">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="app4"><a class="anchor" href="#app4"></a>Application 4</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The third demo will be an app based on Apache with a PVC attached, and we will be using using Snapshots and Data Mover for the the volume backups.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a project called <code>application-04</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>oc new-project application-04</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Go to the Developer perspective in the OpenShift Console and follow the same procedure as in the previous demos.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app04-1.png" alt="app04 1">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Once the application is up and running, we need to attach a PVC to it.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/backups/app04-2.png" alt="app04 2">
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Before creating this backup, we need to enable the Data Mover feature in the <code>DataProtectionApplication</code> resource. This is done by adding the <code>vsm</code> plugin and setting the Data Mover feature to <code>true</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: DataProtectionApplication
apiVersion: oadp.openshift.io/v1alpha1
metadata:
 name: velero-sample
 namespace: openshift-adp
spec:
  backupLocations:
    - velero:
        config:
          resourceGroup: &lt;RESOURCE_GROUP&gt;
          storageAccount: &lt;STORAGE_ACCOUNT&gt;
          storageAccountKeyEnvVar: AZURE_STORAGE_ACCOUNT_ACCESS_KEY
          subscriptionId: &lt;SUBSCRIPTION_ID&gt;
        credential:
          key: cloud
          name: cloud-credentials-azure
        default: true
        objectStorage:
          bucket: &lt;BUCKET_NAME&gt;
          prefix: velero
        provider: azure
  configuration:
    restic:
      enable: true
    velero:
      defaultPlugins:
        - openshift
        - azure
        - csi
        - vsm
  features:
    dataMover:
      credentialName: datamover-restic-secret
      enable: true
      maxConcurrentBackupVolumes: '3'
      maxConcurrentRestoreVolumes: '3'
      pruneInterval: '1'</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create the backup, setting the <code>snapshotVolumes</code> parameter to <code>true</code>. The <code>yaml</code> view of the resource will look like this:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: velero.io/v1
kind: Backup
metadata:
  name: backup-app04
  namespace: openshift-adp
spec:
  includedNamespaces:
    - application-04
  snapshotVolumes: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to check that the backup has been performed successfully, it has to be masked as <strong>Completed</strong>.</p>
</div>
<div class="imageblock unresolved">
<div class="content">
<img src="backups/app04-3.png" alt="app04 3">
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="02-deploy.html">2. Install and configure OADP Operator</a></span>
  <span class="next"><a href="04-restores.html">4. Restore Applications</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
